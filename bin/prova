#!/usr/bin/env node
var command = require('../lib/node-command');
var path = require('path');
var glob = require('flat-glob');
var fs = require('fs');
var exists = fs.existsSync;
var stats = fs.lstatSync;

run();

function run () {
  var files = (command._.length ? command._ : ['test']).map(function (p) {
    if (/^\w+$/.test(p) && exists(p + '.js') && stats(p + '.js').isFile()) {
      return p + '.js';
    }

    if (/^\w+$/.test(p) && exists(p + '/index.js')) {
      return p + '/index.js';
    }

    return p;
  });

  glob(files, function (err, files) {
    (command.browser ? browser : node)(files);
  });
}

function browser (files) {
  files = files.map(function (p) {
    return path.join(process.cwd(), p);
  });

  require('../lib/browser')(files, command);
}

function node (files) {
  files.forEach(function (file) {
    require(path.resolve(process.cwd(), file));
  });
}
